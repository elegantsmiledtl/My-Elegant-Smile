(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[757],{9588:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>y});var a=t(95155),l=t(12115),r=t(20063),i=t(86948),n=t(3998),c=t(54715),d=t(26302),o=t(76604),x=t(14585),h=t(15894),m=t(19056),j=t(19456),p=t(87754),u=t(87270),f=t(13496),N=t(41307),b=t(55172),g=t(54264),v=t.n(g);function y(){let e=(0,r.useRouter)(),[s,t]=(0,l.useState)(""),[g,y]=(0,l.useState)([]),[D,w]=(0,l.useState)(!0),{toast:A}=(0,h.dj)(),P=(0,l.useRef)(null),[S,I]=(0,l.useState)(null),[C,O]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let s=localStorage.getItem("loggedInUser");s?t(JSON.parse(s).name):e.push("/login")},[e]),(0,l.useEffect)(()=>{s&&(async()=>{w(!0);try{let e=await (0,x.dE)(s);y(e)}catch(e){console.error("Firebase Error:",e),A({variant:"destructive",title:"Database Error",description:"Could not fetch your invoices. Please try again."})}finally{w(!1)}})()},[s,A]);let E=(e,s)=>{if(!e)return"N/A";let t=e.toDate?e.toDate():"string"==typeof e?(0,m.H)(e):new Date(e);if(!(0,j.f)(t))return"Invalid Date";try{return(0,p.qD)(t,"Asia/Amman",s)}catch(e){return"Invalid Date"}},F=e=>E(e,"PPP"),J=e=>"number"!=typeof e||isNaN(e)?"0":e.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2}),R=async e=>{I(e),O(!0)};(0,l.useEffect)(()=>{S&&C&&k()},[S,C]);let k=async()=>{let e=P.current;if(!e||!s||!S){A({variant:"destructive",title:"Error",description:"Cannot generate PDF. Invoice data is missing."}),O(!1),I(null);return}try{let t=(await v()(e,{scale:2,useCORS:!0,backgroundColor:null})).toDataURL("image/png"),a=new b.Ay({orientation:"portrait",unit:"mm",format:"a4"}),l=a.internal.pageSize.getWidth(),r=a.internal.pageSize.getHeight(),i=a.getImageProperties(t),n=i.height*l/i.width;a.addImage(t,"PNG",0,0,l,n>r?r:n,void 0,"FAST");let c="invoice-".concat(s.replace(/\s/g,"_"),"-").concat(F(S.createdAt),".pdf");a.save(c),A({title:"Success",description:"Invoice has been saved as a PDF."})}catch(e){console.error("PDF Generation Error:",e),A({variant:"destructive",title:"PDF Error",description:"Failed to generate PDF file."})}finally{O(!1),I(null)}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"min-h-screen bg-background text-foreground",children:[(0,a.jsx)("header",{className:"bg-card border-b shadow-sm p-4",children:(0,a.jsxs)("div",{className:"container mx-auto grid grid-cols-3 items-center",children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(o.default,{width:150,height:40})}),(0,a.jsx)("div",{className:"flex justify-end"})]})}),(0,a.jsx)("main",{className:"p-4 sm:p-6 lg:p-8",children:(0,a.jsxs)(i.Zp,{className:"shadow-lg",children:[(0,a.jsx)(i.aR,{children:(0,a.jsxs)(i.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"w-6 h-6 text-primary"}),"My Invoices"]})}),(0,a.jsx)(i.Wu,{className:"space-y-4",children:D?(0,a.jsx)("p",{children:"Loading invoices..."}):0===g.length?(0,a.jsx)("div",{className:"text-center text-muted-foreground p-8 border-2 border-dashed rounded-lg",children:(0,a.jsx)("p",{children:"You have no invoices yet."})}):(0,a.jsx)(f.nD,{type:"single",collapsible:!0,className:"w-full",children:g.map((e,s)=>(0,a.jsxs)(f.As,{value:"item-".concat(s),children:[(0,a.jsx)(f.$m,{children:(0,a.jsxs)("div",{className:"flex justify-between w-full pr-4",children:[(0,a.jsxs)("span",{children:["Invoice from ",E(e.createdAt,"PPP p")]}),(0,a.jsxs)("span",{className:"font-bold text-primary",children:[J(e.grandTotal)," JOD"]})]})}),(0,a.jsxs)(f.ub,{children:[(0,a.jsxs)(i.Zp,{className:"m-2",children:[(0,a.jsxs)(i.aR,{children:[(0,a.jsx)(i.ZB,{className:"text-lg",children:"Invoice Details"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Date Range: ",e.fromDate?F(e.fromDate):"Start"," - ",e.toDate?F(e.toDate):"End"]})]}),(0,a.jsx)(i.Wu,{children:(0,a.jsxs)(u.XI,{children:[(0,a.jsx)(u.A0,{children:(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nd,{children:"Material"}),(0,a.jsx)(u.nd,{className:"text-right",children:"Unit(s)"}),(0,a.jsx)(u.nd,{className:"text-right",children:"Price per Unit (JOD)"}),(0,a.jsx)(u.nd,{className:"text-right",children:"Total (JOD)"})]})}),(0,a.jsx)(u.BF,{children:Object.entries(e.summary).map(e=>{let[s,t]=e;return t.toothCount>0&&(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nA,{className:"font-medium",children:s}),(0,a.jsx)(u.nA,{className:"text-right",children:t.toothCount}),(0,a.jsx)(u.nA,{className:"text-right",children:J(t.price)}),(0,a.jsx)(u.nA,{className:"text-right font-semibold",children:J(t.total)})]},s)})})]})}),(0,a.jsxs)(i.wL,{className:"bg-muted/50 p-4 justify-end items-center",children:[(0,a.jsxs)(n.$,{onClick:()=>R(e),disabled:C&&(null==S?void 0:S.id)===e.id,size:"sm",className:"mr-auto bg-green-600 hover:bg-green-700 text-white",children:[(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4"}),C&&(null==S?void 0:S.id)===e.id?"Saving...":"Download Invoice"]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 text-right",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 justify-end",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Subtotal:"}),(0,a.jsxs)("p",{className:"text-lg font-semibold w-[120px] text-left",children:[J(e.subtotal)," JOD"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 justify-end",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Paid Amount:"}),(0,a.jsxs)("p",{className:"text-lg font-bold w-[120px] text-left",style:{color:e.paidAmount>0?"red":"inherit"},children:[J(e.paidAmount)," JOD"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 justify-end border-t pt-2 mt-2",children:[(0,a.jsx)("p",{className:"text-lg font-bold",children:"Total Due:"}),(0,a.jsxs)("p",{className:"text-2xl font-bold text-primary w-[120px] text-left",children:[J(e.grandTotal)," JOD"]})]})]})]})]}),e.cases&&e.cases.length>0&&(0,a.jsxs)(i.Zp,{className:"m-2 mt-4",children:[(0,a.jsx)(i.aR,{children:(0,a.jsx)(i.ZB,{className:"text-lg",children:"Cases Included in Invoice"})}),(0,a.jsx)(i.Wu,{children:(0,a.jsx)(N.A,{cases:e.cases,hideDentist:!0,hideDeliveryDate:!0,hideShade:!0})})]})]})]},e.id))})})]})})]}),(0,a.jsx)("div",{className:"fixed -z-50 -top-[9999px] -left-[9999px] w-[800px] bg-white text-black",children:(0,a.jsx)("div",{ref:P,className:"relative p-8",children:S&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center -z-10",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:(0,a.jsx)("img",{src:"https://i.imgur.com/kDubvxf.png",alt:"Watermark",style:{width:"400px",height:"auto",opacity:.1}})}),(0,a.jsxs)("div",{className:"relative z-10 space-y-6",children:[(0,a.jsxs)("div",{className:"text-center mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",style:{color:"#C6A963"},children:"Elegant Smile"}),(0,a.jsx)("h2",{className:"text-2xl",children:"Invoice"})]}),(0,a.jsxs)("div",{className:"flex justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold",children:"Doctor:"}),(0,a.jsx)("p",{children:S.dentistName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-bold",children:"Date Range:"}),(0,a.jsx)("p",{children:"From ".concat(F(S.fromDate)," to ").concat(F(S.toDate))})]})]}),(0,a.jsxs)("table",{className:"w-full border-collapse text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border p-2 text-left",children:"Material"}),(0,a.jsx)("th",{className:"border p-2 text-right",children:"Unit(s)"}),(0,a.jsx)("th",{className:"border p-2 text-right",children:"Price per Unit (JOD)"}),(0,a.jsx)("th",{className:"border p-2 text-right",children:"Total (JOD)"})]})}),(0,a.jsx)("tbody",{children:Object.entries(S.summary).map(e=>{let[s,t]=e;return t.toothCount>0&&(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border p-2 font-medium",children:s}),(0,a.jsx)("td",{className:"border p-2 text-right",children:t.toothCount}),(0,a.jsx)("td",{className:"border p-2 text-right",children:J(t.price)}),(0,a.jsx)("td",{className:"border p-2 text-right font-semibold",children:J(t.total)})]},s)})})]}),(0,a.jsx)("div",{className:"flex justify-end mt-6",children:(0,a.jsxs)("div",{className:"w-2/5 space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center text-lg p-2",children:[(0,a.jsx)("span",{className:"font-bold",children:"Subtotal:"}),(0,a.jsx)("span",{children:"".concat(J(S.subtotal)," JOD")})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-lg p-2",children:[(0,a.jsx)("span",{className:"font-bold",children:"Paid Amount:"}),(0,a.jsx)("span",{className:"font-bold",style:{color:S.paidAmount>0?"red":"inherit"},children:"".concat(J(S.paidAmount)," JOD")})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-xl font-bold p-2 bg-gray-100",children:[(0,a.jsx)("span",{children:"Total Due:"}),(0,a.jsx)("span",{children:"".concat(J(S.grandTotal)," JOD")})]})]})}),(0,a.jsxs)("div",{className:"mt-8",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Cases Included in Invoice"}),(0,a.jsxs)("table",{className:"w-full border-collapse text-xs",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-gray-100",children:[(0,a.jsx)("th",{className:"border p-2 text-left",children:"Created At"}),(0,a.jsx)("th",{className:"border p-2 text-left",children:"Patient"}),(0,a.jsx)("th",{className:"border p-2 text-left",children:"Tooth #(s)"}),(0,a.jsx)("th",{className:"border p-2 text-right",children:"Unit(s)"}),(0,a.jsx)("th",{className:"border p-2 text-left",children:"Prosthesis"}),(0,a.jsx)("th",{className:"border p-2 text-left",children:"Material"}),(0,a.jsx)("th",{className:"border p-2 text-left",children:"Notes"})]})}),(0,a.jsx)("tbody",{children:S.cases.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border p-2",children:F(e.createdAt)}),(0,a.jsx)("td",{className:"border p-2",children:e.patientName}),(0,a.jsx)("td",{className:"border p-2",children:e.toothNumbers}),(0,a.jsx)("td",{className:"border p-2 text-right",children:e.toothNumbers.split(",").filter(e=>""!==e.trim()).length}),(0,a.jsx)("td",{className:"border p-2",children:e.prosthesisType}),(0,a.jsx)("td",{className:"border p-2",children:e.material}),(0,a.jsx)("td",{className:"border p-2",children:e.notes})]},e.id))})]})]})]})]})})})]})}},9817:(e,s,t)=>{Promise.resolve().then(t.bind(t,9588))},13496:(e,s,t)=>{"use strict";t.d(s,{$m:()=>o,As:()=>d,nD:()=>c,ub:()=>x});var a=t(95155),l=t(12115),r=t(86374),i=t(59007),n=t(64269);let c=r.bL,d=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.q7,{ref:s,className:(0,n.cn)("border-b",t),...l})});d.displayName="AccordionItem";let o=l.forwardRef((e,s)=>{let{className:t,children:l,...c}=e;return(0,a.jsx)(r.Y9,{className:"flex",children:(0,a.jsxs)(r.l9,{ref:s,className:(0,n.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...c,children:[l,(0,a.jsx)(i.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});o.displayName=r.l9.displayName;let x=l.forwardRef((e,s)=>{let{className:t,children:l,...i}=e;return(0,a.jsx)(r.UC,{ref:s,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...i,children:(0,a.jsx)("div",{className:(0,n.cn)("pb-4 pt-0",t),children:l})})});x.displayName=r.UC.displayName}},e=>{e.O(0,[992,316,930,481,368,524,746,312,498,88,577,665,689,307,441,255,358],()=>e(e.s=9817)),_N_E=e.O()}]);